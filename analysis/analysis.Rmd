---
title: "R Notebook"
output: html_notebook
---

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(stringr)
```

Load the data files

```{r message=FALSE, warning=FALSE}
data.all <- NA
data.files <- dir('data')
for(f in data.files){
  method <- str_split(f, "_")[[1]][1]
  duration <- as.numeric(str_sub(str_split(f,"_")[[1]][2],start=1,end=-5))
  data.this <- read_tsv(paste0('data/', f)) %>% 
    select(c('Opto 3 Onset', 'Opto 3 Offset')) %>%
    mutate(method=method, duration=duration) %>%
    slice(2:101)
  if(is.na(data.all)){
    data.all <- data.this
  } else {
    data.all <- rbind(data.all, data.this)
  }
}
```

Calculate measured duration
```{r}
data.all <- data.all %>% mutate(obs.duration = `Opto 3 Offset` - `Opto 3 Onset`)
```

Summarize data
```{r}
data.summary <- data.all %>% 
  group_by(method, duration) %>% 
  summarize(mean.obs = mean(obs.duration), sd.obs=sd(obs.duration))
```

Plotting
```{r}
ggplot(data.summary, aes(x=duration, y=mean.obs, ymin=mean.obs-sd.obs, ymax=mean.obs+sd.obs, color=method))+
  geom_abline(intercept=0,slope=1)+
  geom_pointrange()+
  theme_minimal()
```


Plotting, log scale
```{r}
ggplot(data.summary, aes(x=log(duration), y=log(mean.obs), ymin=log(mean.obs-sd.obs), ymax=log(mean.obs+sd.obs), color=method))+
  geom_abline(intercept=0,slope=1)+
  geom_pointrange()+
  theme_minimal()
```
